#!/bin/bash

#################################################
#           Panda Linux installer               #
#                                               #
# Abhimanyu Saharan <desk.abhimanyu@gmail.com>  #
#################################################

source global
source handleErrors
source getPkgs
source functions
source requirementsCheck
source cleanup
source initSetup

# Accept mount point from the user
# FIXME Add leading slash
MOUNT_POINT="${1}"
# Accept partition from the user
PARTITION="${2}"

# Verify existence of mount point
if [ ! -d $MOUNT_POINT ]
then
    displayMsg ERR "Mount point does not exist."
    exit 1
fi

if [ "${MOUNT_POINT}" == "" ]
then
    displayMsg WARN "Usage: ./install <mointPoint>"
    exit 1
fi

# Prepare the filesystem
displayMsg OK "Preparing the filesystem ..."
sudo mount -t ext4 $PARTITION $MOUNT_POINT | ERR=$?
if [ -e $ERR ]
then
    exit 1
fi
displayMsg OK "Done ..."

displayMsg OK "------- PANDA LINUX -------"
displayMsg ""

#################################################################
# Copy the data to the mount point                              #
#################################################################

displayMsg OK "Copying data ..."
#cp -ur ./* $MOUNT_POINT
displayMsg OK "Done ..."

#################################################################

# Download all the packages before continuing
# FIXME: Starts downloading packages even after they have been
#        retrieved completed
#getBasicPkgs
# Verify System Requirements
checkReq
# Create necessary directories
createReqDir
# Start installing the basic packages
initSetup
# Cleanup the system
cleanup